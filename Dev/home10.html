<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>오더즈 - 빠른주문 (고도화)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;700;900&display=swap');
        body {
            font-family: 'Noto Sans KR', sans-serif;
            overscroll-behavior-y: contain;
            -webkit-text-size-adjust: 100%;
            text-size-adjust: 100%;
            -webkit-tap-highlight-color: transparent;
        }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        
        /* 탭 스타일 */
        .tab-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            height: 100%;
            font-size: 0.875rem;
            white-space: nowrap;
            transition: all 0.2s;
            border-bottom: 2px solid transparent;
            min-width: 0;
            padding: 0 1rem;
        }
        .tab-active {
            border-bottom-color: #22c55e;
            color: #16a34a;
            font-weight: 700;
        }
        .tab-inactive {
            color: #6b7280;
            font-weight: 500;
        }

        /* Create List Tab Style */
        .cl-tab-btn {
            flex: 1;
            text-align: center;
            padding: 0.75rem 0;
            font-size: 0.875rem;
            color: #6b7280;
            border-bottom: 2px solid transparent;
            font-weight: 500;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        .cl-tab-btn.active {
            color: #16a34a;
            border-bottom-color: #16a34a;
            font-weight: 700;
        }
        .cl-tab-save {
            flex: 1;
            text-align: center;
            padding: 0.75rem 0;
            font-size: 0.875rem;
            color: #3b82f6;
            font-weight: 700;
            border-bottom: 2px solid transparent;
        }
        .cl-tab-save:active { background-color: #eff6ff; }

        /* Grid Layout */
        .cl-grid-row {
            display: grid;
            grid-template-columns: 40px 1fr 36px 36px 36px 30px;
            gap: 4px;
            padding: 12px 4px;
            background: #fff;
            border-bottom: 1px solid #f3f4f6;
            align-items: center;
        }
        .cl-grid-row.checked { background-color: #f0fdf4; }

        .cl-checkbox {
            width: 20px; height: 20px;
            border-radius: 4px;
            color: #16a34a;
            border: 1px solid #d1d5db;
            accent-color: #16a34a;
        }

        .cl-info {
            display: flex; flex-direction: column; justify-content: center;
            overflow: hidden; padding-right: 4px;
        }
        .cl-name {
            font-size: 13px; font-weight: 600; color: #1f2937;
            white-space: nowrap; overflow: hidden; text-overflow: ellipsis;
        }
        .cl-price { font-size: 11px; color: #9ca3af; margin-top: 1px; }

        .cl-toggle-btn {
            width: 30px; height: 30px; margin: 0 auto;
            border-radius: 6px; border: 1px solid #e5e7eb;
            background: #fff; color: #d1d5db;
            font-size: 10px; font-weight: 700;
            display: flex; align-items: center; justify-content: center;
            transition: all 0.1s;
        }
        .cl-toggle-btn.active {
            background: #22c55e; border-color: #22c55e; color: white;
        }
        
        .cl-drag-handle {
            display: flex; align-items: center; justify-content: center;
            color: #e5e7eb; cursor: grab;
        }

        .cl-select-bar {
            display: flex; align-items: center; justify-content: space-between; padding: 10px 14px;
            background: #f9fafb; border-bottom: 1px solid #eee;
            font-size: 12px; color: #6b7280; font-weight: 600;
            position: sticky; top: 0; z-index: 10;
        }

        /* Guide & Accordion */
        .guide-btn {
            display: flex; align-items: center; gap: 4px;
            font-size: 11px; color: #6b7280; background: #fff;
            padding: 4px 10px; border: 1px solid #e5e7eb; border-radius: 12px;
        }

        .accordion-header {
            display: flex; justify-content: space-between; align-items: center;
            padding: 16px; background-color: #fff; border-bottom: 1px solid #f3f4f6;
            cursor: pointer; transition: background-color 0.2s;
        }
        .accordion-header:active { background-color: #f9fafb; }
        .accordion-content {
            max-height: 0; overflow: hidden; transition: max-height 0.3s cubic-bezier(0, 1, 0, 1);
            background-color: #fff;
        }
        .accordion-item.active .accordion-content {
            max-height: 1200px; transition: max-height 0.4s cubic-bezier(1, 0, 1, 0);
        }
        .accordion-item.active .chevron-icon { transform: rotate(180deg); }
        .chevron-icon { transition: transform 0.2s; }

        /* Keyword Pool */
        .keyword-chip {
            font-size: 11px; padding: 6px 12px; border-radius: 8px;
            background-color: #fff; color: #4b5563; border: 1px solid #e5e7eb;
            cursor: pointer; white-space: nowrap; transition: all 0.2s;
            box-shadow: 0 1px 2px rgba(0,0,0,0.03);
        }
        .keyword-chip:active { background-color: #e5e7eb; transform: scale(0.96); }

        .list-input-group {
            border: 1px solid #e5e7eb; border-radius: 8px; padding: 8px 12px;
            transition: all 0.2s; background-color: #fff;
        }
        .list-input-group.active {
            border-color: #22c55e; background-color: #f0fdf4; box-shadow: 0 0 0 2px rgba(34, 197, 94, 0.1);
        }

        /* Search Animations */
        #search-container {
            transition: max-height 0.3s ease-in-out, opacity 0.3s, padding 0.3s;
            overflow: hidden;
        }
        #search-container.search-hidden {
            max-height: 0;
            opacity: 0;
            padding-top: 0 !important;
            padding-bottom: 0 !important;
            pointer-events: none;
        }

        /* Move Sheet */
        #move-sheet-overlay { background-color: rgba(0,0,0,0.4); transition: opacity 0.2s; }
        #move-sheet { transition: transform 0.3s cubic-bezier(0, 0, 0.2, 1); transform: translateY(100%); }
        #move-sheet.visible { transform: translateY(0); }

        /* Add List Btn */
        .add-list-btn-wide {
            font-size: 0.75rem;
            color: #22c55e;
            font-weight: 700;
            border: 1px solid #22c55e;
            padding: 4px 10px;
            border-radius: 12px;
            background: white;
            white-space: nowrap;
        }

        /* Tooltip (Speech Bubble) */
        .tooltip-bubble {
            position: absolute;
            top: 50px;
            left: 10px;
            background: rgba(30, 41, 59, 0.95);
            color: white;
            padding: 8px 12px;
            border-radius: 8px;
            font-size: 11px;
            font-weight: 500;
            z-index: 50;
            white-space: nowrap;
            opacity: 0;
            transform: translateY(-5px);
            transition: opacity 0.3s, transform 0.3s;
            pointer-events: none;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }
        .tooltip-bubble::before {
            content: '';
            position: absolute;
            top: -4px;
            left: 12px;
            width: 8px;
            height: 8px;
            background: rgba(30, 41, 59, 0.95);
            transform: rotate(45deg);
        }
        .tooltip-visible {
            opacity: 1;
            transform: translateY(0);
        }

        /* Safe area bottom fix */
        .safe-pb { padding-bottom: env(safe-area-inset-bottom); }
    </style>
</head>
<body class="bg-gray-50">

    <div id="app" class="max-w-md mx-auto bg-white shadow-lg min-h-screen pb-20 relative overflow-hidden">

        <!-- HEADER -->
        <header class="sticky top-0 bg-white z-20 shadow-sm border-b">
            <div class="relative flex justify-between items-center p-3 h-[57px]">
                <!-- Mode Switch Button -->
                <button id="mode-switch-btn" class="flex items-center space-x-1.5 text-gray-600 hover:bg-gray-100 rounded-lg px-2 py-1.5 transition relative">
                    <i id="mode-icon" class="fas fa-clipboard-check text-lg"></i>
                    <span id="mode-text" class="text-sm font-bold">주문하기</span>
                </button>
                
                <!-- Tooltip -->
                <div id="mode-tooltip" class="tooltip-bubble">
                    주문하기가 기본 접속 화면으로 설정되었습니다.
                </div>

                <h1 id="header-title" class="absolute left-1/2 -translate-x-1/2 text-2xl font-extrabold text-gray-600 cursor-pointer">NH라인</h1>
                <div class="flex items-center space-x-2">
                    <span class="text-xs font-semibold">OP</span>
                    <i class="fas fa-user-circle text-2xl text-gray-400"></i>
                </div>
            </div>
            <nav id="home-category-nav" class="flex justify-around items-center p-2 border-t hidden">
                <button class="flex flex-col items-center space-y-1 text-gray-600"><i class="fas fa-carrot text-xl text-orange-400"></i><span class="text-xs font-medium">채소/과일</span></button>
                <button class="flex flex-col items-center space-y-1 text-gray-600"><i class="fas fa-fish text-xl text-blue-400"></i><span class="text-xs font-medium">수산/축산</span></button>
                <button class="flex flex-col items-center space-y-1 text-gray-600"><i class="fas fa-snowflake text-xl text-cyan-400"></i><span class="text-xs font-medium">식품/가공</span></button>
                <button class="flex flex-col items-center space-y-1 text-gray-600"><i class="fas fa-bottle-droplet text-xl text-yellow-500"></i><span class="text-xs font-medium">양념/소스</span></button>
                <button class="flex flex-col items-center space-y-1 text-gray-600"><i class="fas fa-utensils text-xl text-gray-500"></i><span class="text-xs font-medium">주방/잡화</span></button>
            </nav>
        </header>

        <!-- HOME MAIN (MALL MODE) -->
        <main id="home-view" class="hidden">
             <div class="flex justify-around items-center px-4 py-2 border-b bg-white sticky top-[57px] z-10">
                <button class="py-2 text-sm font-semibold border-b-2 border-green-500 text-green-500">타임세일</button>
                <button class="py-2 text-sm text-gray-500">경매상품</button>
                <button class="py-2 text-sm text-gray-500">할인상품</button>
                <button class="py-2 text-sm text-gray-500">마감임박</button>
             </div>
             <div id="home-product-list" class="divide-y pb-24"></div>
        </main>

        <!-- QUICK ORDER MAIN (ORDER MODE) -->
        <main id="quick-order-view" class="hidden">
            <div id="sub-header" class="z-10 shadow-md bg-gray-100">
                <div id="my-list-container" class="flex justify-between items-center px-0 bg-white border-b h-[40px]">
                    <div id="my-list-tabs" class="flex flex-1 overflow-x-auto no-scrollbar items-center h-full"></div>
                </div>
                <div id="sort-filter-bar" class="hidden bg-white border-b px-4 py-2 flex items-center space-x-4 text-xs text-gray-500">
                    <button class="sort-chip active" data-sort="latest">최신순</button>
                    <div class="h-3 w-px bg-gray-300"></div>
                    <button class="sort-chip" data-sort="category">카테고리순</button>
                    <div class="h-3 w-px bg-gray-300"></div>
                    <button class="sort-chip" data-sort="frequency">자주쓰는순</button>
                </div>
                <!-- Search Box (Initially Hidden) -->
                <div id="search-container" class="p-3 border-b bg-white search-hidden shadow-inner">
                    <div class="flex items-center w-full">
                        <div class="relative flex-grow">
                            <input type="text" id="product-search-input" placeholder="담은 상품 내 검색" class="w-full pl-10 pr-4 py-2.5 border border-gray-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-green-500 text-sm bg-gray-50">
                            <div class="absolute inset-y-0 left-0 pl-3.5 flex items-center pointer-events-none">
                                <i class="fas fa-search text-gray-400"></i>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div id="product-list-container" class="pb-24">
                <div id="product-list" class="bg-white border-t"></div>
            </div>
            <div id="order-confirmation-container" class="hidden pb-24">
                <div class="flex justify-between items-center px-4 py-3 bg-gray-100">
                    <div class="flex items-baseline space-x-2">
                        <h2 class="text-lg font-bold">담은 상품</h2>
                        <span id="confirmation-total-count" class="text-base font-bold text-green-600"></span>
                    </div>
                    <button id="back-to-list-btn" class="text-sm text-green-600 font-semibold py-1 px-3 border border-green-500 rounded-lg hover:bg-green-50 bg-white">
                        <i class="fas fa-plus mr-1"></i> 상품 추가하기
                    </button>
                </div>
                <div id="confirmation-list" class="bg-white"></div>
            </div>
        </main>

        <!-- CREATE LIST VIEW -->
        <div id="create-list-view" class="hidden absolute inset-0 bg-white z-50 flex flex-col">
            <!-- Header -->
            <header class="flex-none flex justify-between items-center px-4 h-[57px] border-b bg-white shadow-sm z-20">
                <button id="create-list-close-icon" class="text-gray-400 hover:text-gray-600">
                    <i class="fas fa-times text-xl"></i>
                </button>
                <h1 class="text-lg font-bold text-gray-800">리스트 만들기</h1>
                <div class="w-8"></div>
            </header>
            
            <!-- Tabs with Save Button (Main Data Save) -->
            <div class="flex-none flex border-b bg-white z-20">
                <button class="cl-tab-btn active" data-tab="all">전체</button>
                <button class="cl-tab-btn cl-tab-l1" data-tab="1">L1</button>
                <button class="cl-tab-btn cl-tab-l2" data-tab="2">L2</button>
                <button class="cl-tab-btn cl-tab-l3" data-tab="3">L3</button>
                <button class="cl-tab-save" id="create-list-save-btn">저장</button>
            </div>

            <!-- Content Area -->
            <div class="flex-grow overflow-y-auto bg-gray-50 pb-24">
                <!-- Select All Bar -->
                <div class="cl-select-bar">
                    <div class="flex items-center">
                        <input type="checkbox" id="cl-select-all" class="w-5 h-5 rounded border-gray-300 text-green-600 focus:ring-green-500 mr-2 accent-green-600">
                        <label for="cl-select-all" class="cursor-pointer">전체 선택 <span id="cl-selected-count" class="text-green-600 font-bold ml-1">(0)</span></label>
                    </div>
                    <button class="guide-btn shadow-sm" onclick="openGuide()">
                        <i class="fas fa-cog"></i> 이용안내 및 설정
                    </button>
                </div>
                
                <div id="create-list-items" class="divide-y divide-gray-100">
                    <!-- Items -->
                </div>
            </div>

            <!-- Bottom Action Bar (Item Actions) -->
            <div class="absolute bottom-0 left-0 right-0 bg-white border-t shadow-[0_-4px_10px_rgba(0,0,0,0.05)] z-30 safe-pb">
                <div class="flex p-3 gap-2">
                    <button id="cl-bottom-back" class="flex-1 py-3 border border-gray-300 rounded-lg text-gray-600 font-bold bg-white">뒤로가기</button>
                    <button id="cl-bottom-delete" class="flex-1 py-3 border border-red-200 rounded-lg text-red-500 font-bold bg-red-50 disabled:opacity-50" disabled>삭제</button>
                    <button id="cl-bottom-move" class="flex-[1.5] py-3 rounded-lg text-white font-bold bg-green-600 disabled:bg-gray-300" disabled>이동</button>
                </div>
            </div>

            <!-- Move Sheet (Modal) -->
            <div id="move-sheet-overlay" class="hidden absolute inset-0 z-40"></div>
            <div id="move-sheet" class="absolute bottom-0 left-0 right-0 bg-white rounded-t-2xl shadow-[0_-5px_20px_rgba(0,0,0,0.15)] z-50">
                <div class="p-5">
                    <h3 class="font-bold text-lg mb-4 text-center">선택한 상품 이동</h3>
                    <div class="space-y-2">
                        <button class="w-full py-3 rounded-xl border border-gray-200 text-gray-700 font-semibold hover:bg-green-50 btn-move-l1" onclick="applyBatchMove(1)">L1으로 이동</button>
                        <button class="w-full py-3 rounded-xl border border-gray-200 text-gray-700 font-semibold hover:bg-green-50 btn-move-l2" onclick="applyBatchMove(2)">L2으로 이동</button>
                        <button class="w-full py-3 rounded-xl border border-gray-200 text-gray-700 font-semibold hover:bg-green-50 btn-move-l3" onclick="applyBatchMove(3)">L3으로 이동</button>
                    </div>
                    <button id="move-sheet-cancel" class="w-full mt-4 py-3 text-gray-500 font-medium">취소</button>
                </div>
                <div class="h-6 bg-white w-full"></div>
            </div>

            <!-- Guide & Setting Modal (Accordion Style) -->
            <div id="guide-modal-overlay" class="fixed inset-0 bg-black/50 z-[60] hidden transition-opacity opacity-0">
                <div class="flex items-center justify-center min-h-screen px-4">
                    <div class="bg-gray-50 rounded-2xl shadow-2xl w-full max-w-sm max-h-[85vh] overflow-hidden transform transition-transform scale-95 flex flex-col" id="guide-modal-content">
                        <!-- Header -->
                        <div class="flex justify-between items-center p-5 bg-white border-b sticky top-0 z-10">
                            <h3 class="text-lg font-bold text-gray-900">이용 가이드 및 설정</h3>
                            <button onclick="closeGuide()" class="text-gray-400 hover:text-gray-600"><i class="fas fa-times text-lg"></i></button>
                        </div>
                        
                        <div class="flex-grow overflow-y-auto">
                            <!-- Accordion 1: Guide -->
                            <div class="accordion-item border-b active" id="acc-guide">
                                <div class="accordion-header" onclick="toggleAccordion('acc-guide')">
                                    <h4 class="text-sm font-bold text-gray-700 flex items-center"><i class="fas fa-info-circle text-green-500 mr-2"></i> 리스트 생성 / 해제 가이드</h4>
                                    <i class="fas fa-chevron-down text-gray-400 chevron-icon"></i>
                                </div>
                                <div class="accordion-content">
                                    <div class="p-5">
                                        <p class="text-xs text-gray-600 leading-relaxed break-keep bg-white p-4 rounded-xl border border-gray-100 shadow-sm">
                                            상품 목록의 <span class="inline-flex items-center justify-center border border-gray-300 rounded w-5 h-5 text-[10px] font-bold text-gray-400 bg-white mx-0.5 align-middle">1</span>, <span class="inline-flex items-center justify-center border border-gray-300 rounded w-5 h-5 text-[10px] font-bold text-gray-400 bg-white mx-0.5 align-middle">2</span>, <span class="inline-flex items-center justify-center border border-gray-300 rounded w-5 h-5 text-[10px] font-bold text-gray-400 bg-white mx-0.5 align-middle">3</span> 버튼을 눌러보세요.<br><br>
                                            <i class="fas fa-circle text-[6px] mr-1 text-green-500"></i> <span class="text-green-600 font-bold">녹색 활성화</span>: 리스트에 포함됨<br>
                                            <i class="fas fa-circle text-[6px] mr-1 text-gray-300"></i> <span class="text-gray-400 font-bold">회색 비활성</span>: 리스트에서 제외됨<br><br>
                                            하나의 상품을 여러 리스트에 중복해서 담거나, 자유롭게 이동시킬 수 있습니다.
                                        </p>
                                    </div>
                                </div>
                            </div>

                            <!-- Accordion 2: Rename -->
                            <div class="accordion-item border-b" id="acc-rename">
                                <div class="accordion-header" onclick="toggleAccordion('acc-rename')">
                                    <h4 class="text-sm font-bold text-gray-700 flex items-center"><i class="fas fa-edit text-blue-500 mr-2"></i> 리스트 이름 변경</h4>
                                    <i class="fas fa-chevron-down text-gray-400 chevron-icon"></i>
                                </div>
                                <div class="accordion-content">
                                    <div class="p-5">
                                        <div class="flex justify-between items-center mb-4">
                                            <p class="text-[11px] text-gray-400 italic">터치하여 포커스 후 아래 키워드를 선택하세요.</p>
                                            <button onclick="resetListNames()" class="text-xs text-gray-400 underline">초기화</button>
                                        </div>

                                        <!-- Custom Inputs -->
                                        <div class="space-y-2 mb-4">
                                            <div class="list-input-group flex items-center active" id="group-l1" onclick="focusInput(1)">
                                                <span class="text-xs font-bold text-gray-400 w-8">L1</span>
                                                <input type="text" id="input-list1-name" placeholder="L1 명칭" class="outline-none" readonly>
                                            </div>
                                            <div class="list-input-group flex items-center" id="group-l2" onclick="focusInput(2)">
                                                <span class="text-xs font-bold text-gray-400 w-8">L2</span>
                                                <input type="text" id="input-list2-name" placeholder="L2 명칭" class="outline-none" readonly>
                                            </div>
                                            <div class="list-input-group flex items-center" id="group-l3" onclick="focusInput(3)">
                                                <span class="text-xs font-bold text-gray-400 w-8">L3</span>
                                                <input type="text" id="input-list3-name" placeholder="L3 명칭" class="outline-none" readonly>
                                            </div>
                                        </div>

                                        <!-- Multi-Category Keyword Pool -->
                                        <div class="bg-white rounded-xl p-4 border border-gray-100 shadow-inner h-56 overflow-y-auto mb-6">
                                            <div class="mb-4">
                                                <div class="text-[10px] font-bold text-gray-400 mb-2">공간 / 관리 주체</div>
                                                <div class="flex flex-wrap gap-2">
                                                    <button class="keyword-chip" onclick="applyKeyword('주방')">주방</button>
                                                    <button class="keyword-chip" onclick="applyKeyword('홀/바')">홀/바</button>
                                                    <button class="keyword-chip" onclick="applyKeyword('창고')">창고</button>
                                                    <button class="keyword-chip" onclick="applyKeyword('매장')">매장</button>
                                                    <button class="keyword-chip" onclick="applyKeyword('냉장고')">냉장고</button>
                                                </div>
                                            </div>
                                            <div class="mb-4">
                                                <div class="text-[10px] font-bold text-gray-400 mb-2">보관 / 온도</div>
                                                <div class="flex flex-wrap gap-2">
                                                    <button class="keyword-chip" onclick="applyKeyword('신선/냉장')">신선/냉장</button>
                                                    <button class="keyword-chip" onclick="applyKeyword('냉동')">냉동</button>
                                                    <button class="keyword-chip" onclick="applyKeyword('상온/공산')">상온/공산</button>
                                                </div>
                                            </div>
                                            <div class="mb-4">
                                                <div class="text-[10px] font-bold text-gray-400 mb-2">목적 / 용도</div>
                                                <div class="flex flex-wrap gap-2">
                                                    <button class="keyword-chip" onclick="applyKeyword('메인재료')">메인재료</button>
                                                    <button class="keyword-chip" onclick="applyKeyword('부재료')">부재료</button>
                                                    <button class="keyword-chip" onclick="applyKeyword('양념/소스')">양념/소스</button>
                                                    <button class="keyword-chip" onclick="applyKeyword('소모품')">소모품</button>
                                                    <button class="keyword-chip" onclick="applyKeyword('직원식')">직원식</button>
                                                </div>
                                            </div>
                                            <div class="mb-2">
                                                <div class="text-[10px] font-bold text-gray-400 mb-2">발주 주기</div>
                                                <div class="flex flex-wrap gap-2">
                                                    <button class="keyword-chip" onclick="applyKeyword('매일발주')">매일발주</button>
                                                    <button class="keyword-chip" onclick="applyKeyword('정기발주')">정기발주</button>
                                                    <button class="keyword-chip" onclick="applyKeyword('긴급/기타')">긴급/기타</button>
                                                </div>
                                            </div>
                                        </div>

                                        <!-- Moved Action Button Inside Accordion -->
                                        <button onclick="saveListNames()" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-4 rounded-2xl text-sm shadow-lg shadow-blue-100 transition-colors">
                                            설정된 이름으로 변경하기
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- FOOTER (Main) -->
        <footer class="fixed bottom-0 left-0 right-0 max-w-md mx-auto bg-white border-t z-30 flex h-[60px] shadow-[0_-2px_10px_rgba(0,0,0,0.05)] safe-pb">
            <button id="footer-search-btn" class="flex-1 flex flex-col items-center justify-center text-gray-500 border-r border-gray-100 hover:text-green-600 transition-colors">
                <i class="fas fa-search text-xl mb-0.5"></i>
                <span class="text-[10px]">검색</span>
            </button>
            <button id="footer-cta-btn" class="flex-1 flex flex-col items-center justify-center transition-colors bg-white text-gray-300">
                <div class="flex items-center space-x-1 mb-0.5"><span id="footer-logo" class="font-extrabold text-sm">ORDERZ</span></div>
                <span id="cta-text" class="text-[10px] font-bold">상품을 담아 주세요</span>
            </button>
            <button id="footer-inquiry-btn" class="flex-1 flex flex-col items-center justify-center text-gray-500 border-l border-gray-100 hover:text-green-600 transition-colors">
                <i class="fas fa-comment-dots text-xl mb-0.5"></i>
                <span class="text-[10px]">문의</span>
            </button>
        </footer>

    </div>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        const appState = {
            products: { 
                vegetable: [
                    { id: 1, name: '흙쪽파(1kg)단', spec: '판매처: a유통', price: 9800, img: 'https://placehold.co/80x80/d1e7dd/333333?text=쪽파', category: 'vegetable', subCategory: '무/배추/조미채소', thirdCategory: '쪽파', liked: true, myList: [], deliveryDate: '2025-10-21', likedTimestamp: 1729770000000 },
                    { id: 2, name: '깐양파_10kg', spec: '판매처: a유통', price: 19500, img: 'https://placehold.co/80x80/d1e7dd/333333?text=양파', category: 'vegetable', subCategory: '무/배추/조미채소', thirdCategory: '양파', liked: true, myList: [], deliveryDate: '2025-10-22' },
                    { id: 3, name: '무우 (낱개)', spec: '판매처: a유통', price: 2800, img: 'https://placehold.co/80x80/d1e7dd/333333?text=무', category: 'vegetable', subCategory: '무/배추/조미채소', thirdCategory: '무우', liked: true, myList: [] },
                    { id: 12, name: '백다다기_5개입', price: 3500, spec: '판매처: a유통', category: 'vegetable', subCategory: '오이/호박/고추/피망', thirdCategory: '오이', myList: [], liked: true },
                    { id: 52, name: '베이컨(알찬)', price: 11500, spec: '판매처: a유통', category: 'seafood', subCategory: '돼지고기', thirdCategory: '가공육', myList: [], liked: true },
                    { id: 63, name: '식용유(말)쉐프원', price: 47800, spec: '판매처: a유통', category: 'sauce', subCategory: '기름', thirdCategory: '식용유', myList: [], liked: true },
                ],
            },
            cart: {},
            listNames: { 1: '리스트1', 2: '리스트2', 3: '리스트3' },
            currentView: 'quick-order', // Initial dummy value, will be set by localStorage
            currentMyList: -1,
            clTab: 'all',
            tempChanges: {},
            hasChanges: false,
            activeListInputId: 1,
            isSearching: false,
            tooltipTimeout: null
        };

        const homeView = document.getElementById('home-view');
        const quickOrderView = document.getElementById('quick-order-view');
        const createListView = document.getElementById('create-list-view');
        const homeProductListEl = document.getElementById('home-product-list');
        const modeSwitchBtn = document.getElementById('mode-switch-btn');
        const headerTitle = document.getElementById('header-title');
        const footerCtaBtn = document.getElementById('footer-cta-btn');
        const ctaText = document.getElementById('cta-text');
        const myListTabsContainer = document.getElementById('my-list-tabs');
        const clTabs = document.querySelectorAll('.cl-tab-btn');
        const clItemsEl = document.getElementById('create-list-items');
        const clSaveBtn = document.getElementById('create-list-save-btn');
        const clSelectAll = document.getElementById('cl-select-all');
        const clSelectedCount = document.getElementById('cl-selected-count');
        const clBottomDelete = document.getElementById('cl-bottom-delete');
        const clBottomMove = document.getElementById('cl-bottom-move');
        const moveSheet = document.getElementById('move-sheet');
        const moveSheetOverlay = document.getElementById('move-sheet-overlay');
        const moveSheetCancel = document.getElementById('move-sheet-cancel');
        const guideModalOverlay = document.getElementById('guide-modal-overlay');
        const guideModalContent = document.getElementById('guide-modal-content');
        const footerSearchBtn = document.getElementById('footer-search-btn');
        const searchContainer = document.getElementById('search-container');
        const productSearchInput = document.getElementById('product-search-input');
        const modeTooltip = document.getElementById('mode-tooltip');
        const modeIcon = document.getElementById('mode-icon');
        const modeText = document.getElementById('mode-text');

        function getAllProducts() {
            return Object.values(appState.products).flat();
        }

        function getActiveLists() {
            const activeSet = new Set();
            getAllProducts().forEach(p => (p.myList || []).forEach(id => activeSet.add(id)));
            return [1, 2, 3].filter(id => activeSet.has(id));
        }

        function showHomeView(saveToStorage = false) {
            appState.currentView = 'home';
            homeView.classList.remove('hidden');
            quickOrderView.classList.add('hidden');
            createListView.classList.add('hidden');
            updateFooterUI();
            updateHeaderUI();
            renderHomeView();
            if(saveToStorage) saveDefaultView('home');
        }

        function showQuickOrderView(saveToStorage = false) {
            appState.currentView = 'quick-order';
            homeView.classList.add('hidden');
            quickOrderView.classList.remove('hidden');
            createListView.classList.add('hidden');
            renderListTabs();
            updateFooterUI();
            updateHeaderUI();
            renderProducts();
            if(saveToStorage) saveDefaultView('quick-order');
        }

        function saveDefaultView(view) {
            localStorage.setItem('orderz_start_mode', view);
        }

        function updateHeaderUI() {
            if (appState.isSearching) {
                // 검색 모드: 뒤로가기
                modeIcon.className = "fas fa-arrow-left text-lg";
                modeText.textContent = "뒤로";
            } else if (appState.currentView === 'home') {
                // 상품목록(Mall) 모드
                modeIcon.className = "fas fa-bars text-lg";
                modeText.textContent = "상품목록";
            } else {
                // 주문하기(Order) 모드
                modeIcon.className = "fas fa-clipboard-check text-lg";
                modeText.textContent = "주문하기";
            }
        }

        function showModeTooltip(text) {
            modeTooltip.textContent = text;
            modeTooltip.classList.add('tooltip-visible');
            
            if (appState.tooltipTimeout) clearTimeout(appState.tooltipTimeout);
            
            appState.tooltipTimeout = setTimeout(() => {
                modeTooltip.classList.remove('tooltip-visible');
            }, 2500);
        }

        // Mode Switch Logic
        modeSwitchBtn.onclick = function() {
            // Case 1: 검색 중이면 뒤로가기(검색 닫기)
            if (appState.isSearching) {
                closeSearch();
                return;
            }

            // Case 2: 모드 전환
            if (appState.currentView === 'home') {
                showQuickOrderView(true);
                showModeTooltip("주문하기가 기본 접속 화면으로 설정되었습니다.");
            } else {
                showHomeView(true);
                showModeTooltip("상품목록이 기본 접속 화면으로 설정되었습니다.");
            }
        };

        // Header Title Click (Same as Mode Switch but without saving default??)
        // Request said only Left Button logic. Keeping Title logic as alias for now or removing?
        // Let's keep title as simple nav alias but without saving preference logic to keep it simple, 
        // OR make it same behavior. The user spec focused on the button. 
        // Let's make title click behave same for consistency.
        headerTitle.onclick = modeSwitchBtn.onclick;

        window.openCreateListView = function() {
            appState.tempChanges = {};
            appState.hasChanges = false;
            appState.clTab = 'all';
            getAllProducts().filter(p => p.liked).forEach(p => appState.tempChanges[p.id] = [...(p.myList || [])]);
            clTabs.forEach(t => t.classList.toggle('active', t.dataset.tab === 'all'));
            syncCreateListTabNames();
            clSelectAll.checked = false;
            createListView.classList.remove('hidden');
            renderCreateList();
        };

        function closeCreateListView() {
            if (appState.hasChanges && !confirm("저장하지 않은 변경사항이 있습니다. 나가시겠습니까?")) return;
            createListView.classList.add('hidden');
            renderListTabs();
            if (appState.currentView === 'quick-order') renderProducts();
        }

        function saveCreateListChanges() {
            const allProducts = getAllProducts();
            for (const [idStr, listIds] of Object.entries(appState.tempChanges)) {
                const id = parseInt(idStr);
                const p = allProducts.find(prod => prod.id === id);
                if (p) {
                    p.myList = [...listIds];
                }
            }
            alert("저장되었습니다.");
            appState.hasChanges = false;
            createListView.classList.add('hidden');
            renderListTabs();
            renderProducts();
        }

        function syncCreateListTabNames() {
            document.querySelector('.cl-tab-l1').textContent = appState.listNames[1];
            document.querySelector('.cl-tab-l2').textContent = appState.listNames[2];
            document.querySelector('.cl-tab-l3').textContent = appState.listNames[3];
            document.querySelector('.btn-move-l1').textContent = `${appState.listNames[1]}으로 이동`;
            document.querySelector('.btn-move-l2').textContent = `${appState.listNames[2]}으로 이동`;
            document.querySelector('.btn-move-l3').textContent = `${appState.listNames[3]}으로 이동`;
        }

        function renderCreateList() {
            const currentTab = appState.clTab;
            const liked = getAllProducts().filter(p => p.liked);
            let filtered = (currentTab === 'all') ? liked : liked.filter(p => (appState.tempChanges[p.id] || []).includes(parseInt(currentTab)));

            if (filtered.length === 0) {
                clItemsEl.innerHTML = `<div class="p-10 text-center text-gray-400 text-sm">표시할 상품이 없습니다.</div>`;
            } else {
                clItemsEl.innerHTML = filtered.map(p => {
                    const currentLists = appState.tempChanges[p.id] || [];
                    const getBtn = (id) => `<button class="cl-toggle-btn ${currentLists.includes(id) ? 'active' : ''}" onclick="event.stopPropagation(); toggleListMember(${p.id}, ${id})">${id}</button>`;
                    return `
                    <div class="cl-grid-row" onclick="toggleRowCheck(this, ${p.id})">
                        <div class="cl-checkbox-wrapper flex items-center justify-center">
                            <input type="checkbox" class="cl-checkbox row-checkbox" value="${p.id}" onclick="event.stopPropagation(); updateBottomActions()">
                        </div>
                        <div class="cl-info">
                            <div class="cl-name">${p.name}</div>
                            <div class="cl-price">${p.price.toLocaleString()}원</div>
                        </div>
                        <div>${getBtn(1)}</div><div>${getBtn(2)}</div><div>${getBtn(3)}</div>
                        <div class="cl-drag-handle"><i class="fas fa-bars"></i></div>
                    </div>`;
                }).join('');
            }
            updateBottomActions();
        }

        window.toggleAccordion = function(id) {
            const items = document.querySelectorAll('.accordion-item');
            items.forEach(item => {
                if(item.id === id) item.classList.toggle('active');
                else item.classList.remove('active');
            });
        };

        window.openGuide = function() {
            guideModalOverlay.classList.remove('hidden');
            document.getElementById('input-list1-name').value = appState.listNames[1];
            document.getElementById('input-list2-name').value = appState.listNames[2];
            document.getElementById('input-list3-name').value = appState.listNames[3];
            focusInput(1);
            setTimeout(() => {
                guideModalOverlay.classList.remove('opacity-0');
                guideModalContent.classList.remove('scale-95');
            }, 10);
        };

        window.closeGuide = function() {
            guideModalOverlay.classList.add('opacity-0');
            guideModalContent.classList.add('scale-95');
            setTimeout(() => guideModalOverlay.classList.add('hidden'), 200);
        };

        window.focusInput = function(id) {
            appState.activeListInputId = id;
            document.querySelectorAll('.list-input-group').forEach(el => el.classList.remove('active'));
            document.getElementById(`group-l${id}`).classList.add('active');
        };

        window.applyKeyword = function(kw) {
            document.getElementById(`input-list${appState.activeListInputId}-name`).value = kw;
        };

        window.saveListNames = function() {
            appState.listNames[1] = document.getElementById('input-list1-name').value || '리스트1';
            appState.listNames[2] = document.getElementById('input-list2-name').value || '리스트2';
            appState.listNames[3] = document.getElementById('input-list3-name').value || '리스트3';
            syncCreateListTabNames();
            renderCreateList();
            closeGuide();
        };

        window.resetListNames = function() {
            document.getElementById('input-list1-name').value = '리스트1';
            document.getElementById('input-list2-name').value = '리스트2';
            document.getElementById('input-list3-name').value = '리스트3';
            focusInput(1);
        };

        window.toggleRowCheck = function(row) {
            const cb = row.querySelector('.row-checkbox');
            if (cb) {
                cb.checked = !cb.checked;
                updateBottomActions();
            }
        };

        window.updateBottomActions = function() {
            const checkboxes = clItemsEl.querySelectorAll('.row-checkbox');
            const checked = Array.from(checkboxes).filter(cb => cb.checked);
            clSelectedCount.textContent = `(${checked.length})`;
            clSelectAll.checked = checkboxes.length > 0 && checked.length === checkboxes.length;
            checkboxes.forEach(cb => cb.closest('.cl-grid-row').classList.toggle('checked', cb.checked));
            clBottomDelete.disabled = clBottomMove.disabled = checked.length === 0;
            clBottomDelete.textContent = checked.length > 0 ? `삭제 (${checked.length})` : '삭제';
            clBottomMove.textContent = checked.length > 0 ? `이동 (${checked.length})` : '이동';
        };

        window.toggleListMember = function(pid, lid) {
            let list = appState.tempChanges[pid] || [];
            appState.tempChanges[pid] = list.includes(lid) ? list.filter(i => i !== lid) : [...list, lid].sort();
            appState.hasChanges = true;
            renderCreateList();
        };

        window.applyBatchMove = function(targetLid) {
            const checked = clItemsEl.querySelectorAll('.row-checkbox:checked');
            checked.forEach(cb => {
                const pid = parseInt(cb.value);
                let list = appState.tempChanges[pid] || [];
                if (!list.includes(targetLid)) list.push(targetLid);
                if (appState.clTab !== 'all') list = list.filter(i => i !== parseInt(appState.clTab));
                appState.tempChanges[pid] = list.sort();
            });
            appState.hasChanges = true;
            moveSheetOverlay.classList.add('hidden');
            moveSheet.classList.remove('visible');
            renderCreateList();
        };

        modeSwitchBtn.onclick = headerTitle.onclick = () => {
             if (appState.isSearching) {
                closeSearch();
                return;
            }
            if (appState.currentView === 'home') {
                showQuickOrderView(true);
                showModeTooltip("주문하기가 기본 접속 화면으로 설정되었습니다.");
            } else {
                showHomeView(true);
                showModeTooltip("상품목록이 기본 접속 화면으로 설정되었습니다.");
            }
        };

        document.getElementById('create-list-close-icon').onclick = document.getElementById('cl-bottom-back').onclick = closeCreateListView;
        document.getElementById('create-list-save-btn').onclick = saveCreateListChanges;
        clSelectAll.onchange = (e) => {
            clItemsEl.querySelectorAll('.row-checkbox').forEach(cb => cb.checked = e.target.checked);
            updateBottomActions();
        };
        clBottomMove.onclick = () => { moveSheetOverlay.classList.remove('hidden'); moveSheet.classList.add('visible'); };
        moveSheetCancel.onclick = moveSheetOverlay.onclick = () => { moveSheetOverlay.classList.add('hidden'); moveSheet.classList.remove('visible'); };
        clBottomDelete.onclick = () => {
            if(!confirm("선택한 상품을 리스트에서 제외할까요?")) return;
            clItemsEl.querySelectorAll('.row-checkbox:checked').forEach(cb => {
                const pid = parseInt(cb.value);
                if(appState.clTab === 'all') appState.tempChanges[pid] = [];
                else appState.tempChanges[pid] = (appState.tempChanges[pid] || []).filter(i => i !== parseInt(appState.clTab));
            });
            appState.hasChanges = true;
            renderCreateList();
        };

        clTabs.forEach(btn => btn.onclick = () => {
            clTabs.forEach(t => t.classList.remove('active'));
            btn.classList.add('active');
            appState.clTab = btn.dataset.tab;
            clSelectAll.checked = false;
            renderCreateList();
        });

        footerSearchBtn.onclick = function() {
            if (appState.currentView === 'home') {
                alert("홈 검색 기능 준비중");
                return;
            }
            appState.isSearching = !appState.isSearching;
            searchContainer.classList.toggle('search-hidden', !appState.isSearching);
            updateHeaderUI(); // 헤더 아이콘 변경 (뒤로가기 <-> 모드 아이콘)

            if (appState.isSearching) {
                setTimeout(() => productSearchInput.focus(), 300);
            } else {
                productSearchInput.value = '';
                renderProducts();
            }
        };

        window.closeSearch = function() {
            appState.isSearching = false;
            searchContainer.classList.add('search-hidden');
            productSearchInput.value = '';
            updateHeaderUI();
            renderProducts();
        };

        productSearchInput.oninput = function(e) {
            const term = e.target.value.toLowerCase();
            const list = getAllProducts().filter(p => p.liked && p.name.toLowerCase().includes(term));
            renderProductListWithItems(list);
        };

        function renderProductListWithItems(items) {
            document.getElementById('product-list').innerHTML = items.map(p => `
            <div class="product-item flex items-center p-3 bg-white border-b">
                <div class="flex-grow"><div class="text-sm font-bold">${p.name}</div><div class="text-xs text-gray-500">${p.price.toLocaleString()}원</div></div>
                <div class="flex items-center border rounded bg-white"><button class="w-8 h-8" onclick="updateQty(${p.id},-1)">-</button><div class="w-8 text-center text-sm font-bold">${appState.cart[p.id]||0}</div><button class="w-8 h-8" onclick="updateQty(${p.id},1)">+</button></div>
            </div>`).join('');
        }

        function updateFooterUI() {
            const hasItems = Object.keys(appState.cart).length > 0;
            const canClick = appState.currentView === 'home' || hasItems;
            const footerLogo = document.getElementById('footer-logo');
            
            let btnClass = "flex-1 flex flex-col items-center justify-center transition-colors bg-white ";
            
            // 상태와 관계없이 항상 홈과 동일한 디자인(색상) 적용
            if(footerLogo) footerLogo.className = "font-extrabold text-sm text-green-800";
            ctaText.className = "text-[10px] font-bold text-gray-500";
            
            if (canClick) {
                btnClass += "cursor-pointer hover:bg-gray-50";
            } else {
                btnClass += "cursor-default";
            }
            
            footerCtaBtn.className = btnClass;
            ctaText.textContent = appState.currentView === 'home' ? "주문하러 가기" : (hasItems ? `(${Object.values(appState.cart).reduce((a,b)=>a+b,0)}) 담은 상품 확인` : "상품을 담아 주세요");
            footerCtaBtn.onclick = appState.currentView === 'home' ? showQuickOrderView : (hasItems ? showConfirmationView : null);
        }

        function renderHomeView() {
            homeProductListEl.innerHTML = getAllProducts().slice(0, 5).map(p => `
            <div class="flex items-center p-4 bg-white border-b">
                <img src="${p.img}" class="w-16 h-16 rounded mr-4">
                <div class="flex-grow"><div class="font-bold">${p.name}</div><div class="text-green-600 font-bold">${p.price.toLocaleString()}원</div></div>
                <input type="checkbox" class="w-6 h-6 rounded text-green-600 border-gray-300 accent-green-600" ${p.liked?'checked':''} onchange="toggleLike(${p.id}, this.checked)">
            </div>`).join('');
        }

        window.toggleLike = function(id, val) {
            const p = getAllProducts().find(x => x.id === id);
            if(p) p.liked = val;
        };

        function renderListTabs() {
            const active = getActiveLists();
            const isSpecialActive = appState.currentMyList === 0;
            const starColor = isSpecialActive ? 'text-yellow-400' : 'text-gray-300';

            myListTabsContainer.innerHTML = `<button class="tab-btn ${isSpecialActive?'tab-active':'tab-inactive'} px-4" onclick="switchMainList(0)">
            <i class="fas fa-star mr-1 ${starColor}"></i>단골특가</button>
            <button class="tab-btn ${appState.currentMyList===-1?'tab-active':'tab-inactive'} px-4" onclick="switchMainList(-1)">찜한상품</button>` +
            active.map(id => `<button class="tab-btn ${appState.currentMyList===id?'tab-active':'tab-inactive'} px-4" onclick="switchMainList(${id})">${appState.listNames[id]}</button>`).join('') +
            `<div class="flex-grow"></div><button class="add-list-btn-wide ml-2" onclick="openCreateListView()">+ 리스트 만들기</button>`;
        }

        window.switchMainList = function(id) { appState.currentMyList = id; renderListTabs(); renderProducts(); };

        function renderProducts() {
            const list = getAllProducts().filter(p => p.liked);
            let filtered = [];
            if(appState.currentMyList === 0) filtered = getAllProducts().slice(0,2);
            else if(appState.currentMyList === -1) filtered = list;
            else filtered = list.filter(p => (p.myList||[]).includes(appState.currentMyList));
            renderProductListWithItems(filtered);
        }

        window.updateQty = function(id, d) {
            appState.cart[id] = Math.max(0, (appState.cart[id]||0) + d);
            if(appState.cart[id] === 0) delete appState.cart[id];
            renderProducts(); updateFooterUI();
        };

        function showConfirmationView() { alert("주문 확인 화면 (준비중)"); }

        // Start Logic: Check LocalStorage
        const savedMode = localStorage.getItem('orderz_start_mode');
        if (savedMode === 'home') {
            showHomeView();
        } else {
            showQuickOrderView(); // Default is quick-order
        }
    });
</script>
</body>
</html>
