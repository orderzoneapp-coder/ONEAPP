<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì˜¤ë”ì¦ˆ ë§ˆì¼€íŒ… ë§í¬ ê´€ë¦¬ì (Final Text Update)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700&display=swap');
        body { font-family: 'Noto Sans KR', sans-serif; background-color: #f2f5f9; }
        
        /* í…Œì´ë¸” ìŠ¤íƒ€ì¼ ì •ë°€ ì¡°ì • */
        .tbl_frm { border-collapse: collapse; width: 100%; }
        .tbl_frm th { background-color: #f8fafc; padding: 14px 16px; text-align: left; font-weight: 600; border-bottom: 1px solid #e2e8f0; color: #334155; width: 150px; border-right: 1px solid #f1f5f9; }
        .tbl_frm td { padding: 14px 16px; border-bottom: 1px solid #e2e8f0; background-color: #fff; }
        
        /* ë§ˆì§€ë§‰ ì¤„ í…Œë‘ë¦¬ ì²˜ë¦¬ */
        .tbl_frm tr:last-child th, 
        .tbl_frm tr:last-child td { border-bottom: 0; }

        /* ëª©ë¡ í…Œì´ë¸” */
        .tbl_head th { background-color: #f1f5f9; padding: 12px 16px; font-weight: 600; font-size: 13px; border-bottom: 2px solid #e2e8f0; color: #475569; text-align: left; text-transform: uppercase; letter-spacing: 0.05em; }
        .tbl_head td { padding: 16px; border-bottom: 1px solid #f1f5f9; font-size: 14px; color: #334155; vertical-align: middle; }
        .tbl_head tr:last-child td { border-bottom: 0; }
        .tbl_head tr:hover td { background-color: #f8fafc; transition: background-color 0.2s; }

        .toggle-checkbox:checked { right: 0; border-color: #2563eb; }
        .toggle-checkbox:checked + .toggle-label { background-color: #2563eb; }
    </style>
</head>
<body class="text-slate-800">

    <!-- ìƒë‹¨ í—¤ë” -->
    <header class="bg-white border-b border-slate-200 px-8 py-4 mb-6 shadow-sm sticky top-0 z-50">
        <div class="flex justify-between items-center max-w-7xl mx-auto w-full">
            <div>
                <h1 class="text-xl font-bold text-slate-800"><i class="fas fa-link text-blue-600 mr-2"></i>ë§ˆì¼€íŒ… ë§í¬ ë¹Œë”</h1>
                <p class="text-xs text-slate-500 mt-1">ì›ë§í¬ + UTM íŒŒë¼ë¯¸í„° ì¡°í•© ë° ë‹¨ì¶• (UI ìµœì¢… ì •ë¦¬)</p>
            </div>
            <div class="text-right">
                <span class="text-xs bg-slate-800 text-white px-2 py-1 rounded font-bold">Ver 24.2 (Label Color)</span>
            </div>
        </div>
    </header>

    <div class="max-w-7xl mx-auto px-6 pb-20">

        <!-- ë§í¬ ë¹Œë” í¼ -->
        <section class="mb-10">
            <div class="flex items-center gap-2 mb-3 border-l-4 border-blue-600 pl-3">
                <h2 class="text-base font-bold text-slate-700">ì‹ ê·œ ìº í˜ì¸ ê¸°íš ë° ìƒì„±</h2>
            </div>
            
            <div class="bg-white border border-slate-300 rounded-sm shadow-sm overflow-hidden">
                <table class="tbl_frm">
                    <tbody>
                        <!-- STEP 1: ìº í˜ì¸ ì •ë³´ -->
                        <tr>
                            <th>
                                <span class="bg-blue-600 text-white w-5 h-5 inline-flex items-center justify-center rounded-full text-[10px] mr-1">1</span>
                                ìº í˜ì¸ ì •ë³´ <span class="text-red-500">*</span><br>
                                <span class="text-[10px] font-normal text-slate-400">(ìš´ì˜ì)</span>
                            </th>
                            <td colspan="3">
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                    <!-- ëª©ì  -->
                                    <div>
                                        <label class="block text-xs font-bold text-blue-800 mb-1">
                                            ìº í˜ì¸ ëª… <span class="text-red-500">*</span>
                                        </label>
                                        <input type="text" id="inputMemo" class="w-full border border-blue-200 bg-blue-50 px-3 py-2.5 rounded focus:border-blue-500 outline-none text-sm font-bold text-slate-700 transition" 
                                            placeholder="ì˜ˆ: 24ë…„ ì—¬ë¦„ ì •ê¸° ì„¸ì¼" oninput="updatePreview()">
                                        <p class="text-[10px] text-slate-400 mt-1">
                                            * ê´€ë¦¬ì ëª©ë¡ ì‹ë³„ìš© ëª…ì¹­ì…ë‹ˆë‹¤.
                                        </p>
                                    </div>
                                    <!-- ì£¼ì²´ -->
                                    <div>
                                        <div class="flex justify-between items-center mb-1">
                                            <label class="block text-xs font-bold text-slate-600">
                                                ë‹´ë‹¹ ìœ í†µì‚¬
                                            </label>
                                            <span class="text-[10px] text-slate-400 bg-slate-100 px-1.5 py-0.5 rounded border border-slate-200">(ë¯¸ì…ë ¥ ì‹œ 'ë³¸ì‚¬')</span>
                                        </div>
                                        <input type="text" id="inputYt" class="w-full border border-slate-300 px-3 py-2.5 rounded focus:border-blue-500 outline-none text-sm transition" 
                                            placeholder="ì˜ˆ: ABC001" oninput="updatePreview()">
                                        <p class="text-[10px] text-slate-400 mt-1">
                                            * ìœ í†µì‚¬ ì…ë ¥ ì‹œ ê°€ì… íšŒì›ì€ ìœ í†µì‚¬ì˜ ì „ìš©íšŒì›ìœ¼ë¡œ ë“±ë¡ë©ë‹ˆë‹¤.
                                        </p>
                                    </div>
                                </div>
                            </td>
                        </tr>

                        <!-- STEP 2: ì—°ê²° ì„¤ì • -->
                        <tr>
                            <th>
                                <span class="bg-slate-500 text-white w-5 h-5 inline-flex items-center justify-center rounded-full text-[10px] mr-1">2</span>
                                ì—°ê²° ì„¤ì • <span class="text-red-500">*</span><br>
                                <span class="text-[10px] font-normal text-slate-400">(ì±„ë„ & ëœë”©í˜ì´ì§€)</span>
                            </th>
                            <td colspan="3">
                                <div class="flex flex-col gap-4">
                                    <!-- ìœ ì… ì±„ë„ (ë¨¼ì €) -->
                                    <div>
                                        <label class="block text-xs font-bold text-slate-600 mb-1">
                                            ê´‘ê³ /í™ë³´ ì±„ë„ <span class="text-blue-600 font-normal">(GA4 source / medium)</span>
                                        </label>
                                        <select id="inputSrc" class="w-full md:w-1/2 border border-slate-300 px-2 py-2 rounded focus:border-blue-500 outline-none text-sm transition" onchange="updatePreview()">
                                            <option value="referral" data-source="homepage" data-medium="referral">ê¸°ë³¸ (ì›¹ì‚¬ì´íŠ¸/ë¸”ë¡œê·¸)</option>
                                            <optgroup label="ê´‘ê³  (Paid)">
                                                <option value="paid_search" data-source="naver" data-medium="cpc">Paid Search (ë„¤ì´ë²„ íŒŒì›Œë§í¬)</option>
                                                <option value="paid_social" data-source="instagram" data-medium="paidsocial">Paid Social (ì¸ìŠ¤íƒ€/í˜ë¶ ê´‘ê³ )</option>
                                                <option value="display" data-source="gdn" data-medium="display">Display (ë°°ë„ˆ ê´‘ê³ )</option>
                                            </optgroup>
                                            <optgroup label="ë©”ì‹œì§€/CRM">
                                                <option value="messaging" data-source="kakao" data-medium="talk">Messaging (ì•Œë¦¼í†¡/ë¬¸ì)</option>
                                                <option value="email" data-source="crm" data-medium="email">Email (ë‰´ìŠ¤ë ˆí„°)</option>
                                            </optgroup>
                                            <optgroup label="ì˜¤í”„ë¼ì¸/ê¸°íƒ€">
                                                <option value="internal" data-source="sales" data-medium="qr">Internal (QR/ì˜ì—…ì‚¬ì›)</option>
                                                <option value="affiliates" data-source="partner" data-medium="affiliate">Affiliates (ì œíœ´ì‚¬)</option>
                                            </optgroup>
                                        </select>
                                    </div>
                                    
                                    <!-- ì›ë§í¬ (ë‚˜ì¤‘) -->
                                    <div>
                                        <label class="block text-xs font-bold text-slate-700 mb-1">ëœë”©í˜ì´ì§€ (ì›ë³¸ URL)</label>
                                        <input type="text" id="inputBaseUrl" 
                                            class="w-full border border-blue-300 px-3 py-2.5 rounded text-slate-700 focus:border-blue-500 outline-none shadow-sm font-medium transition" 
                                            placeholder="https://orderz.kr/member/join.php"
                                            oninput="updatePreview()">
                                    </div>
                                </div>
                            </td>
                        </tr>

                        <!-- STEP 3: íšŒì›ê°€ì… ë¦¬ë‹¤ì´ë ‰íŠ¸ ì„¤ì • -->
                        <tr class="border-t border-slate-200">
                            <th>
                                <span class="bg-slate-400 text-white w-5 h-5 inline-flex items-center justify-center rounded-full text-[10px] mr-1">3</span>
                                íšŒì›ê°€ì… í›„ ì´ë™<br>
                                <span class="text-[10px] font-normal text-slate-400 block mt-1">ì‹ ê·œ/ê¸°ì¡´ (íœ´ëŒ€í° ê²€ì¦)</span>
                            </th>
                            <td colspan="3">
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                    <!-- ì‹ ê·œ -->
                                    <div class="space-y-1">
                                        <label class="block text-xs font-bold text-slate-700">
                                            <i class="fas fa-arrow-right mr-1 text-blue-500"></i>ì‹ ê·œ íšŒì› (Next URL)
                                        </label>
                                        <input type="text" id="inputNext" 
                                            class="w-full border border-slate-300 px-3 py-2 rounded text-slate-600 focus:border-slate-500 outline-none text-xs bg-slate-50 focus:bg-white transition" 
                                            placeholder="ì˜ˆ: /event/coupon.php"
                                            oninput="updatePreview()">
                                    </div>
                                    <!-- ê¸°ì¡´ -->
                                    <div class="space-y-1">
                                        <label class="block text-xs font-bold text-slate-600">
                                            <i class="fas fa-history mr-1 text-orange-500"></i>ê¸°ì¡´ íšŒì› / íœ´ëŒ€í° ì¤‘ë³µ (Fallback)
                                        </label>
                                        <input type="text" id="inputNextExist" 
                                            class="w-full border border-slate-300 px-3 py-2 rounded text-slate-600 focus:border-slate-500 outline-none text-xs bg-slate-50 focus:bg-white transition" 
                                            placeholder="ì˜ˆ: /index.php"
                                            oninput="updatePreview()">
                                    </div>
                                </div>
                                <p class="text-[10px] text-red-500 mt-2 font-bold flex items-center">
                                    <i class="fas fa-shield-alt mr-1"></i> â€»ë³´ì•ˆ: https://orderz.kr ë’¤ì— ë¶™ëŠ” ê²½ë¡œë§Œ ì…ë ¥í•˜ì„¸ìš”. ì˜ˆ) / , /shop , /event/coupon.php
                                </p>
                            </td>
                        </tr>

                        <!-- í”„ë¦¬ë·° -->
                        <tr class="bg-slate-50 border-t border-slate-200">
                            <th class="align-middle">
                                <span class="text-[10px] bg-slate-500 text-white px-2 py-1 rounded font-bold">PREVIEW</span>
                            </th>
                            <td colspan="3">
                                <div class="flex flex-col gap-1">
                                    <span class="text-xs text-slate-500 font-bold">ğŸ”» ìë™ ì¡°í•©ëœ ì—°ê²° ì£¼ì†Œ (UTM + ë¦¬ë‹¤ì´ë ‰íŠ¸ í¬í•¨)</span>
                                    <div id="previewUrl" class="font-mono text-xs text-blue-600 break-all bg-white border border-blue-200 p-3 rounded select-all shadow-sm">
                                        https://orderz.kr/member/join.php?utm_source=homepage&utm_medium=referral
                                    </div>
                                    <div class="text-[10px] text-slate-500 mt-1 space-x-3">
                                        <span><i class="fas fa-tag text-slate-400"></i> ë©”ëª¨(ë‚´ë¶€ìš©): <span class="font-bold text-slate-700" id="previewMemo">-</span></span>
                                        <span><i class="fas fa-user text-slate-400"></i> ì£¼ì²´: <span class="font-bold text-slate-700" id="previewYt">-</span></span>
                                    </div>
                                </div>
                            </td>
                        </tr>

                        <!-- STEP 4: ë§í¬ ìƒì„± -->
                        <tr class="bg-blue-50 border-t border-blue-100">
                            <th class="align-middle">
                                <span class="bg-blue-600 text-white w-5 h-5 inline-flex items-center justify-center rounded-full text-[10px] mr-1">4</span>
                                ë§í¬ ìƒì„± <span class="text-red-500">*</span><br>
                                <span class="text-[10px] font-normal text-slate-400">(Action)</span>
                            </th>
                            <td colspan="3">
                                <div class="flex flex-col md:flex-row gap-4 items-end">
                                    <!-- ì…ë ¥ì°½ (50%) -->
                                    <div class="w-full md:w-1/2">
                                        <label class="block text-xs font-bold text-slate-700 mb-1">
                                            ë‹¨ì¶• ì½”ë“œ (Short Code) <span class="text-[10px] text-blue-600 font-normal ml-2">* GA4 ìº í˜ì¸ í‚¤(utm_campaign)</span>
                                        </label>
                                        <div class="flex items-center">
                                            <span class="inline-flex items-center px-3 h-11 rounded-l-lg border border-r-0 border-slate-300 bg-white text-slate-500 text-sm font-mono font-bold">orderz.kr/l/</span>
                                            <input type="text" id="inputCode" placeholder="summer_2024" 
                                                class="flex-1 h-11 border border-slate-300 px-3 rounded-r-lg focus:border-blue-500 outline-none font-bold text-lg text-slate-800 shadow-sm transition"
                                                oninput="updatePreview()">
                                        </div>
                                        <p class="text-[10px] text-slate-400 mt-1">
                                            * ì˜ë¬¸, ìˆ«ì, ì–¸ë”ë°”(_)ë§Œ ì‚¬ìš©. <span class="text-red-500 ml-1 font-bold">* ìš´ì˜ì¤‘ì¸ ë‹¨ì¶• ì½”ë“œëŠ” ìƒì„±í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</span>
                                        </p>
                                    </div>
                                    
                                    <!-- ë²„íŠ¼ (ë‚˜ë¨¸ì§€ ì±„ì›€) -->
                                    <button onclick="createLink()" class="flex-1 w-full h-11 px-6 bg-blue-600 text-white rounded-lg hover:bg-blue-700 hover:shadow-lg transition text-sm font-bold flex items-center justify-center gap-2 whitespace-nowrap mb-0.5 shadow-md transform active:scale-95">
                                        <i class="fas fa-magic"></i> ë§í¬ ìƒì„± ë° í™œì„±í™”
                                    </button>
                                </div>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </section>

        <!-- ê´€ë¦¬ ëª©ë¡ -->
        <section>
            <div class="flex justify-between items-end mb-3">
                <h2 class="text-base font-bold text-slate-700 border-l-4 border-slate-600 pl-3">ìƒì„± ëª©ë¡ <span id="totalCount" class="text-xs font-normal text-slate-500 ml-1">(0ê°œ)</span></h2>
                <div class="flex gap-2">
                    <input type="text" id="searchInput" placeholder="ìº í˜ì¸ ë©”ëª¨, ì½”ë“œ ê²€ìƒ‰" class="border border-slate-300 px-3 py-1.5 text-sm rounded w-64 outline-none focus:border-blue-500 transition" onkeyup="filterList()">
                </div>
            </div>

            <div class="bg-white border border-slate-300 rounded-lg shadow-sm overflow-hidden">
                <table class="w-full text-left tbl_head">
                    <thead>
                        <tr>
                            <th class="w-16 text-center">ìƒíƒœ</th>
                            <th class="w-1/4">ìº í˜ì¸ ëª… / ë‹´ë‹¹ ìœ í†µì‚¬</th>
                            <th class="w-1/3">ì—°ê²° ë§í¬ / ë‹¨ì¶• ë§í¬</th>
                            <th class="text-center">ì±„ë„ / ìœ ì…</th>
                            <th class="w-24 text-center">ìƒì„±ì¼</th>
                        </tr>
                    </thead>
                    <tbody id="linkListBody">
                        <!-- JS ë Œë”ë§ -->
                    </tbody>
                </table>
            </div>
            
            <div class="mt-4 text-center text-xs text-slate-400">
                <p>â€» ëª©ë¡ì€ ìµœì‹ ìˆœìœ¼ë¡œ í‘œì‹œë©ë‹ˆë‹¤. ë™ì¼í•œ ë‹¨ì¶• ì½”ë“œëŠ” í•˜ë‚˜ë§Œ ìš´ì˜í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
            </div>
        </section>

    </div>

    <script>
        // ì´ˆê¸° ë°ì´í„° (Mock)
        let linkData = [
            { 
                id: 101, 
                code: "summer_2024", 
                full_url: "https://orderz.kr/event/summer.php?utm_source=instagram&utm_medium=paidsocial&utm_campaign=summer_2024&yt_code=OFF001",
                base_url: "https://orderz.kr/event/summer.php",
                memo: "ì—¬ë¦„ ê°€ì… ì´ë²¤íŠ¸ (ì¸ìŠ¤íƒ€)", 
                yt: "OFF001",
                active: false, 
                hits: 50, 
                channel: "paid_social",
                created_at: "2023-10-30" 
            },
            { 
                id: 102, 
                code: "summer_2024", 
                full_url: "https://orderz.kr/member/join.php?utm_source=instagram&utm_medium=paidsocial&utm_campaign=summer_2024&yt_code=OFF001",
                base_url: "https://orderz.kr/member/join.php",
                memo: "ì—¬ë¦„ ì„¸ì¼ ìˆ˜ì • (ì‹ ë²„ì „)",
                yt: "OFF001", 
                active: true, 
                hits: 1520, 
                channel: "paid_social",
                created_at: "2023-11-01" 
            },
            { 
                id: 2, 
                code: "main_home", 
                full_url: "https://orderz.kr/?utm_source=homepage&utm_medium=referral",
                base_url: "https://orderz.kr/",
                memo: "ë©”ì¸ í™ˆí˜ì´ì§€ (ê¸°ë³¸)",
                yt: "-", 
                active: true, 
                hits: 3400, 
                channel: "referral",
                created_at: "2023-10-20" 
            }
        ];

        const DOM = {
            inputBaseUrl: document.getElementById('inputBaseUrl'),
            inputSrc: document.getElementById('inputSrc'),
            inputMemo: document.getElementById('inputMemo'),
            inputYt: document.getElementById('inputYt'),
            inputCode: document.getElementById('inputCode'),
            inputNext: document.getElementById('inputNext'),
            inputNextExist: document.getElementById('inputNextExist'),
            previewUrl: document.getElementById('previewUrl'),
            previewMemo: document.getElementById('previewMemo'),
            previewYt: document.getElementById('previewYt'),
            listBody: document.getElementById('linkListBody'),
            totalCount: document.getElementById('totalCount')
        };

        // 1. ì‹¤ì‹œê°„ ë¯¸ë¦¬ë³´ê¸° (ë°ì´í„° í‘œì¤€í™” ë¡œì§ ì ìš©)
        function updatePreview() {
            const baseUrl = DOM.inputBaseUrl.value.trim() || 'https://orderz.kr/member/join.php';
            const selectedOption = DOM.inputSrc.options[DOM.inputSrc.selectedIndex];
            
            let params = [];
            
            // 1. UTM Standardized Logic
            if (selectedOption.dataset.source) params.push(`utm_source=${selectedOption.dataset.source}`);
            if (selectedOption.dataset.medium) params.push(`utm_medium=${selectedOption.dataset.medium}`);
            const campaignKey = DOM.inputCode.value.trim();
            if (campaignKey) params.push(`utm_campaign=${campaignKey}`);
            
            // MemoëŠ” ë”ì´ìƒ utm_contentë¡œ ë³´ë‚´ì§€ ì•ŠìŒ (ë‚´ë¶€ìš©)
            
            const ytCode = DOM.inputYt.value.trim();
            if (ytCode) params.push(`yt_code=${encodeURIComponent(ytCode)}`);

            // 2. Redirect Parameters
            const next = DOM.inputNext.value.trim();
            if (next) params.push(`next=${encodeURIComponent(next)}`);
            const nextExist = DOM.inputNextExist.value.trim();
            if (nextExist) params.push(`next_exist=${encodeURIComponent(nextExist)}`);

            // Combine
            const separator = baseUrl.includes('?') ? '&' : '?';
            const finalUrl = params.length > 0 ? `${baseUrl}${separator}${params.join('&')}` : baseUrl;
            
            DOM.previewUrl.textContent = finalUrl;
            
            // í”„ë¦¬ë·°ìš© ì¶”ê°€ ì •ë³´ í‘œì‹œ
            DOM.previewMemo.textContent = DOM.inputMemo.value.trim() || '-';
            DOM.previewYt.textContent = ytCode || 'ë³¸ì‚¬';

            return finalUrl;
        }

        // 2. ë¦¬ìŠ¤íŠ¸ ë Œë”ë§
        function renderList(data = linkData) {
            DOM.listBody.innerHTML = "";
            DOM.totalCount.textContent = `(${data.length}ê°œ)`;

            const sortedData = [...data].sort((a, b) => b.id - a.id);

            if (sortedData.length === 0) {
                DOM.listBody.innerHTML = `<tr><td colspan="5" class="text-center py-10 text-slate-400">ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.</td></tr>`;
                return;
            }

            sortedData.forEach(item => {
                const tr = document.createElement('tr');
                tr.className = item.active ? 'hover:bg-slate-50 transition' : 'bg-slate-100 opacity-60 text-slate-400 grayscale';

                const channelColors = {
                    'paid_search': 'bg-blue-100 text-blue-800',
                    'paid_social': 'bg-indigo-100 text-indigo-800',
                    'referral': 'bg-slate-100 text-slate-700',
                    'messaging': 'bg-green-100 text-green-800'
                };
                const badgeColor = channelColors[item.channel] || 'bg-gray-100 text-gray-600';
                const finalBadge = item.active ? badgeColor : 'bg-gray-200 text-gray-500';
                const ytDisplay = item.yt === '-' || !item.yt ? 'ë³¸ì‚¬' : item.yt;

                // ìƒì„±ì¼ í¬ë§· (YY-MM-DD)
                const dateParts = item.created_at.split('-');
                const shortDate = dateParts.length === 3 ? `${dateParts[0].slice(2)}-${dateParts[1]}-${dateParts[2]}` : item.created_at;

                tr.innerHTML = `
                    <td class="text-center align-middle relative">
                        <div class="relative inline-block w-8 mr-1 align-middle select-none">
                            <input type="checkbox" id="toggle-${item.id}" class="toggle-checkbox absolute block w-4 h-4 rounded-full bg-white border-4 appearance-none cursor-pointer border-slate-300 transition-all duration-300 ease-in-out" ${item.active ? 'checked' : ''} onchange="toggleActive(${item.id})"/>
                            <label for="toggle-${item.id}" class="toggle-label block overflow-hidden h-4 rounded-full bg-slate-300 cursor-pointer transition-colors duration-300 ease-in-out"></label>
                        </div>
                    </td>
                    <td class="px-4 py-4 align-top">
                        <div class="flex flex-col gap-1.5">
                            <div class="font-bold ${item.active ? 'text-slate-800' : 'text-slate-500'} text-sm cursor-pointer hover:text-blue-600" onclick="copyToForm(${item.id})" title="í´ë¦­ ì‹œ ì„¤ì • ë¶ˆëŸ¬ì˜¤ê¸°">
                                ${item.memo || '<span class="text-slate-300">ë©”ëª¨ ì—†ìŒ</span>'} <i class="fas fa-edit ml-1 text-slate-300 opacity-0 group-hover:opacity-100 text-[10px]"></i>
                            </div>
                            <div class="text-xs text-slate-500 flex items-center gap-1">
                                <span class="bg-slate-100 border border-slate-200 px-1.5 py-0.5 rounded text-[10px] font-mono text-slate-400">ì£¼ì²´</span>
                                <span class="font-medium ${item.active ? 'text-slate-600' : 'text-slate-400'}">${ytDisplay}</span>
                            </div>
                        </div>
                    </td>
                    <td class="px-4 py-4 align-top">
                        <div class="flex flex-col gap-2">
                            <!-- ì›ë³¸ ì£¼ì†Œ (View Only) -->
                            <div class="text-[11px] text-slate-400 truncate max-w-sm bg-slate-50 px-2 py-1 rounded border border-slate-100 group cursor-help select-all" title="${item.full_url}">
                                <i class="fas fa-link mr-1 opacity-50"></i> ${item.full_url}
                            </div>
                            <!-- ë‹¨ì¶• ë§í¬ -->
                            <div class="flex items-center gap-2">
                                <span class="${item.active ? 'text-blue-600' : 'text-slate-400'} font-bold text-sm font-mono cursor-pointer hover:underline" onclick="copyCode('${item.code}')">
                                    orderz.kr/l/${item.code}
                                </span>
                                <button class="text-slate-300 hover:text-blue-500 transition" onclick="copyCode('${item.code}')" title="ë³µì‚¬"><i class="far fa-copy"></i></button>
                            </div>
                        </div>
                    </td>
                    <td class="px-4 py-4 align-middle text-center">
                        <div class="flex flex-col items-center gap-1">
                            <span class="${finalBadge} px-2 py-0.5 rounded text-[10px] font-bold uppercase mb-1">${item.channel}</span>
                            <div class="text-sm font-mono font-bold ${item.active ? 'text-slate-700' : 'text-slate-400'}">${item.hits.toLocaleString()} <span class="text-[10px] text-slate-400 font-normal">Hits</span></div>
                        </div>
                    </td>
                    <td class="text-center text-xs text-slate-500 font-mono align-middle">
                        ${shortDate}
                    </td>
                `;
                DOM.listBody.append(tr);
            });
        }

        // 3. ë§í¬ ìƒì„±
        function createLink() {
            const baseUrl = DOM.inputBaseUrl.value.trim();
            const code = DOM.inputCode.value.trim();
            const memo = DOM.inputMemo.value.trim();
            const yt = DOM.inputYt.value.trim();
            const fullUrl = DOM.previewUrl.textContent.trim();
            const next = DOM.inputNext.value.trim();
            const nextExist = DOM.inputNextExist.value.trim();

            if (!baseUrl) return alert("ëœë”©í˜ì´ì§€(ì›ë³¸ URL)ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.");
            if (!memo) return alert("ìº í˜ì¸ ëª…ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.");
            if (!code) return alert("ë‹¨ì¶• ì½”ë“œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.");
            
            // ì •ê·œì‹: ì˜ë¬¸ ì†Œë¬¸ì, ìˆ«ì, -, _ ë§Œ í—ˆìš©
            const codeRegex = /^[a-z0-9_-]+$/;
            if (!codeRegex.test(code)) {
                alert("ë‹¨ì¶• ì½”ë“œëŠ” 'ì˜ë¬¸ ì†Œë¬¸ì', 'ìˆ«ì', 'í•˜ì´í”ˆ(-)', 'ì–¸ë”ë°”(_)'ë§Œ ì‚¬ìš© ê°€ëŠ¥í•©ë‹ˆë‹¤.");
                DOM.inputCode.focus();
                return;
            }

            if (next && !next.startsWith('/')) {
                alert("ë³´ì•ˆì„ ìœ„í•´ ì‹ ê·œ íšŒì› ì´ë™ ê²½ë¡œëŠ” ë‚´ë¶€ ê²½ë¡œ('/')ë§Œ í—ˆìš©ë©ë‹ˆë‹¤.");
                DOM.inputNext.focus();
                return;
            }
            if (nextExist && !nextExist.startsWith('/')) {
                alert("ë³´ì•ˆì„ ìœ„í•´ ê¸°ì¡´ íšŒì› ì´ë™ ê²½ë¡œëŠ” ë‚´ë¶€ ê²½ë¡œ('/')ë§Œ í—ˆìš©ë©ë‹ˆë‹¤.");
                DOM.inputNextExist.focus();
                return;
            }

            // [ë³€ê²½ë¨] ì¤‘ë³µ ìš´ì˜ ë°©ì§€ ë¡œì§ (Strict Mode)
            const existingActiveLink = linkData.find(l => l.code === code && l.active);
            if (existingActiveLink) {
                alert(`âš ï¸ [${code}] ì½”ë“œëŠ” ì´ë¯¸ 'ìš´ì˜ì¤‘'ì…ë‹ˆë‹¤.\n\në™ì¼í•œ ì½”ë“œëŠ” ì¤‘ë³µ ìš´ì˜í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.\nê¸°ì¡´ ìº í˜ì¸ì„ 'ì¤‘ì§€' ìƒíƒœë¡œ ë³€ê²½í•œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.`);
                return; // ìƒì„± ì¤‘ë‹¨
            }

            const newLink = {
                id: Date.now(),
                code: code,
                full_url: fullUrl,
                base_url: baseUrl,
                memo: memo,
                yt: yt || '-',
                active: true,
                hits: 0,
                channel: DOM.inputSrc.value,
                created_at: new Date().toISOString().split('T')[0]
            };

            linkData.push(newLink);
            renderList();
            
            // ì…ë ¥ ì´ˆê¸°í™” (Reset)
            DOM.inputBaseUrl.value = "";
            DOM.inputMemo.value = "";
            DOM.inputYt.value = "";
            DOM.inputSrc.selectedIndex = 0;
            DOM.inputCode.value = "";
            DOM.inputNext.value = "";
            DOM.inputNextExist.value = "";
            
            updatePreview();

            alert(`[${code}] ë§í¬ê°€ ì•ˆì „í•˜ê²Œ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤.\n(GA4 Key: ${code})`);
        }

        // 4. ì •ë³´ ë¶ˆëŸ¬ì˜¤ê¸° (ë¦¬ìŠ¤íŠ¸ í´ë¦­ ì‹œ)
        function copyToForm(id) {
            const item = linkData.find(l => l.id === id);
            if(!item) return;

            if(confirm("ì„ íƒí•œ ìº í˜ì¸ì˜ ì„¤ì •ì„ ë¶ˆëŸ¬ì˜¤ì‹œê² ìŠµë‹ˆê¹Œ?")) {
                DOM.inputBaseUrl.value = item.base_url;
                DOM.inputMemo.value = item.memo;
                DOM.inputCode.value = item.code;
                DOM.inputSrc.value = item.channel;
                DOM.inputYt.value = item.yt !== '-' ? item.yt : '';
                
                updatePreview();
                window.scrollTo({ top: 0, behavior: 'smooth' });
            }
        }

        function filterList() {
            const keyword = document.getElementById('searchInput').value.toLowerCase();
            const filtered = linkData.filter(l => 
                l.code.toLowerCase().includes(keyword) || 
                l.memo.toLowerCase().includes(keyword)
            );
            renderList(filtered);
        }

        function copyCode(code) {
            navigator.clipboard.writeText(`https://orderz.kr/l/${code}`);
            alert(`[orderz.kr/l/${code}] ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤.`);
        }

        function toggleActive(id) {
            const target = linkData.find(l => l.id === id);
            if(!target) return;

            // ì¼œë ¤ê³  í•  ë•Œ ì¤‘ë³µ ì²´í¬ (Strict)
            if (!target.active) {
                const duplicate = linkData.find(l => l.code === target.code && l.active && l.id !== id);
                if (duplicate) {
                    alert(`âš ï¸ [${target.code}] ì½”ë“œëŠ” ì´ë¯¸ ìš´ì˜ì¤‘ì…ë‹ˆë‹¤.\n\në™ì¼ ì½”ë“œëŠ” í•˜ë‚˜ë§Œ í™œì„±í™”í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.\nê¸°ì¡´ ìº í˜ì¸(${duplicate.memo})ì„ ë¨¼ì € ì¤‘ì§€í•´ì£¼ì„¸ìš”.`);
                    renderList(); // UI ìƒíƒœ ë³µêµ¬ (ì²´í¬ë°•ìŠ¤ ë‹¤ì‹œ êº¼ì§)
                    return;
                }
            }
            target.active = !target.active;
            renderList();
        }

        // ì´ˆê¸° ì‹¤í–‰
        updatePreview();
        renderList();

    </script>
</body>
</html>
