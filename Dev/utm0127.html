<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>오더즈 링크 관리 (Lite)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700&display=swap');
        body { font-family: 'Noto Sans KR', sans-serif; }
    </style>
</head>
<body class="bg-gray-100 text-gray-800">

    <div class="flex h-screen overflow-hidden">
        <!-- 사이드바 (개발 시 include 처리) -->
        <aside class="w-64 bg-gray-900 text-white flex-shrink-0 hidden md:flex flex-col">
            <div class="p-6 text-xl font-bold border-b border-gray-700">Orderz Admin</div>
            <nav class="flex-1 p-4 space-y-2">
                <a href="#" class="block py-2.5 px-4 rounded hover:bg-gray-800 text-gray-400"><i class="fas fa-home w-6"></i> 대시보드</a>
                <a href="#" class="block py-2.5 px-4 rounded bg-blue-600 text-white font-medium"><i class="fas fa-link w-6"></i> 마케팅 링크 관리</a>
            </nav>
        </aside>

        <!-- 메인 컨텐츠 -->
        <div class="flex-1 flex flex-col overflow-y-auto">
            <header class="bg-white shadow-sm z-10 p-4 flex justify-between items-center">
                <h1 class="text-lg font-bold text-gray-800">마케팅 링크 관리 (Lite)</h1>
                <button class="text-sm text-gray-500 hover:text-blue-600" onclick="location.reload()">
                    <i class="fas fa-sync-alt mr-1"></i> 새로고침
                </button>
            </header>

            <main class="p-6 max-w-5xl mx-auto w-full">
                
                <!-- 1. 링크 생성 영역 (핵심 기능) -->
                <div class="bg-white rounded-lg shadow-sm border border-gray-200 mb-6">
                    <div class="p-4 border-b border-gray-100 bg-gray-50 flex justify-between items-center">
                        <h2 class="font-bold text-gray-700"><i class="fas fa-plus-circle text-blue-500 mr-2"></i>단축 링크 생성</h2>
                        <span class="text-xs text-gray-400">입력값은 생성 후에도 유지됩니다 (연속 생성 가능)</span>
                    </div>

                    <div class="p-6 space-y-4">
                        <!-- 필수 입력: 도착 URL -->
                        <div>
                            <label class="block text-xs font-bold text-gray-700 mb-1">도착할 주소 (Target URL) <span class="text-red-500">*</span></label>
                            <input type="text" id="baseUrl" placeholder="https://..." class="w-full text-sm border border-gray-300 rounded px-3 py-2 focus:border-blue-500 focus:outline-none" oninput="updatePreview()">
                        </div>

                        <!-- 선택 입력: 파라미터 (단순 나열) -->
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-3 bg-slate-50 p-3 rounded border border-slate-100">
                            <div>
                                <label class="block text-xs font-medium text-gray-600 mb-1">유통사 코드 (선택)</label>
                                <input type="text" id="paramYtCode" placeholder="예: ABC001" class="w-full text-sm border-gray-300 rounded px-2 py-1.5" oninput="updatePreview()">
                                <p class="text-[10px] text-orange-600 mt-1 leading-tight">* 입력 시 유통사 전용 회원으로 가입됩니다.</p>
                            </div>
                            <div>
                                <label class="block text-xs font-medium text-gray-600 mb-1">유입 채널 (Source)</label>
                                <select id="paramSrc" class="w-full text-sm border-gray-300 rounded px-2 py-1.5" onchange="updatePreview()">
                                    <option value="" data-medium="">선택 안함</option>
                                    <option value="sms" data-medium="sms">문자 (SMS)</option>
                                    <option value="kakao" data-medium="social">카카오톡</option>
                                    <option value="search_ad" data-medium="cpc">검색광고</option>
                                    <option value="qr" data-medium="qr">QR코드</option>
                                    <option value="partner" data-medium="affiliate">거래처/영업</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-xs font-medium text-gray-600 mb-1">캠페인명</label>
                                <input type="text" id="paramCamp" placeholder="예: summer" class="w-full text-sm border-gray-300 rounded px-2 py-1.5" oninput="updatePreview()">
                            </div>
                        </div>

                        <!-- 최종 URL 미리보기 -->
                        <div class="text-[11px] text-gray-400 font-mono truncate" id="finalUrlPreview">
                            (주소 입력 시 자동 완성됨)
                        </div>

                        <hr class="border-gray-100">

                        <!-- 하단: 단축코드 & 버튼 -->
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <!-- 단축코드 입력 (중복확인 버튼 제거) -->
                            <div>
                                <label class="block text-xs font-bold text-gray-700 mb-1">단축 코드 (Short Code) <span class="text-red-500">*</span></label>
                                <div class="flex relative">
                                    <span class="inline-flex items-center px-3 rounded-l border border-r-0 border-gray-300 bg-gray-50 text-gray-500 text-sm">/l/</span>
                                    <input type="text" id="shortCode" placeholder="비워두면 자동생성" 
                                        class="flex-1 text-sm border border-gray-300 rounded-r px-3 py-2 focus:border-blue-500 focus:outline-none">
                                </div>
                                <p class="text-[11px] mt-1 text-gray-400">직접 입력 시, 생성 버튼을 누르면 자동으로 중복을 검사합니다.</p>
                            </div>

                            <!-- 메모 입력 -->
                            <div>
                                <label class="block text-xs font-bold text-gray-700 mb-1">관리용 메모</label>
                                <input type="text" id="memo" placeholder="예: 7월 여름 정기세일 문자용" class="w-full text-sm border border-gray-300 rounded px-3 py-2 focus:border-blue-500 focus:outline-none">
                            </div>
                        </div>

                        <!-- 생성 버튼 -->
                        <div class="flex justify-end pt-2">
                            <button onclick="createLink()" class="w-full md:w-auto px-8 py-3 bg-gray-900 text-white font-bold rounded hover:bg-gray-800 transition transform hover:-translate-y-0.5 shadow-md">
                                <i class="fas fa-check mr-2"></i> 링크 생성하기
                            </button>
                        </div>
                    </div>
                </div>

                <!-- 2. 목록 영역 (심플 리스트) -->
                <div class="bg-white rounded-lg shadow-sm border border-gray-200">
                    <div class="p-4 border-b border-gray-100 flex flex-col md:flex-row justify-between items-center gap-4">
                        <h3 class="font-bold text-gray-700 whitespace-nowrap">최근 생성 목록 (50개)</h3>
                        <!-- 클라이언트 검색 (개발 공수 0) -->
                        <div class="relative w-full md:w-auto">
                            <input type="text" id="searchInput" onkeyup="filterList()" 
                                placeholder="메모, 코드, URL 등 부분 일치 검색 가능" 
                                class="w-full md:w-96 pl-10 pr-4 py-2.5 text-sm border border-gray-300 rounded-lg shadow-sm focus:border-blue-500 focus:ring-2 focus:ring-blue-200 focus:outline-none transition-all">
                            <i class="fas fa-search absolute left-3.5 top-3.5 text-gray-400"></i>
                        </div>
                    </div>
                    
                    <div class="overflow-x-auto">
                        <table class="min-w-full divide-y divide-gray-200" id="dataTable">
                            <thead class="bg-gray-50 text-gray-500 text-xs uppercase">
                                <tr>
                                    <th class="px-4 py-3 text-left w-32">단축코드</th>
                                    <th class="px-4 py-3 text-left">연결 정보 (Target & Memo)</th>
                                    <th class="px-4 py-3 text-center w-20">클릭</th>
                                    <th class="px-4 py-3 text-right w-20">삭제</th>
                                </tr>
                            </thead>
                            <tbody class="bg-white divide-y divide-gray-200 text-sm">
                                <!-- 리스트 아이템 -->
                                <tr>
                                    <td class="px-4 py-3 whitespace-nowrap">
                                        <button onclick="copyLink('abc_mart')" class="text-blue-600 font-bold hover:underline">
                                            /abc_mart <i class="far fa-copy ml-1 text-gray-400"></i>
                                        </button>
                                    </td>
                                    <td class="px-4 py-3">
                                        <div class="font-medium text-gray-800">ABC마트 전용 링크</div>
                                        <div class="text-xs text-gray-500 truncate max-w-md mt-0.5">
                                            .../join?yt_code=ABC001&src=partner
                                        </div>
                                    </td>
                                    <td class="px-4 py-3 text-center text-gray-500">120</td>
                                    <td class="px-4 py-3 text-right">
                                        <button class="text-gray-300 hover:text-red-500"><i class="fas fa-trash"></i></button>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="px-4 py-3 whitespace-nowrap">
                                        <button onclick="copyLink('summer_sms')" class="text-blue-600 font-bold hover:underline">
                                            /summer_sms <i class="far fa-copy ml-1 text-gray-400"></i>
                                        </button>
                                    </td>
                                    <td class="px-4 py-3">
                                        <div class="font-medium text-gray-800">7월 문자 발송용</div>
                                        <div class="text-xs text-gray-500 truncate max-w-md mt-0.5">
                                            .../join_simple.php?src=sms&camp=summer
                                        </div>
                                    </td>
                                    <td class="px-4 py-3 text-center text-gray-500">45</td>
                                    <td class="px-4 py-3 text-right">
                                        <button class="text-gray-300 hover:text-red-500"><i class="fas fa-trash"></i></button>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                        <!-- 더보기 버튼 (페이지네이션 대신) -->
                        <div class="text-center py-3 border-t border-gray-100">
                            <button class="text-xs text-gray-500 hover:text-gray-800">더 보기 <i class="fas fa-chevron-down ml-1"></i></button>
                        </div>
                    </div>
                </div>

            </main>
        </div>
    </div>

    <!-- 토스트 메시지 -->
    <div id="toast" class="fixed bottom-10 left-1/2 transform -translate-x-1/2 bg-gray-800 text-white px-4 py-2 rounded shadow-lg text-sm opacity-0 transition-opacity duration-300 pointer-events-none">
        링크가 복사되었습니다.
    </div>

    <script>
        // 1. URL 미리보기 업데이트
        function updatePreview() {
            const base = document.getElementById('baseUrl').value.trim();
            const yt = document.getElementById('paramYtCode').value.trim();
            const src = document.getElementById('paramSrc').value;
            const camp = document.getElementById('paramCamp').value.trim();
            
            if(!base) {
                document.getElementById('finalUrlPreview').textContent = "(주소 입력 시 자동 완성됨)";
                return;
            }

            let params = [];
            if(yt) params.push('yt_code=' + encodeURIComponent(yt));
            if(src) params.push('src=' + src);
            if(camp) params.push('campaign=' + encodeURIComponent(camp));

            let url = base;
            if(params.length > 0) {
                url += (base.includes('?') ? '&' : '?') + params.join('&');
            }
            document.getElementById('finalUrlPreview').textContent = url;
        }

        // 2. 링크 생성 (중복 체크 포함)
        function createLink() {
            const base = document.getElementById('baseUrl').value;
            const codeInput = document.getElementById('shortCode');
            let code = codeInput.value.trim();
            
            if(!base) { 
                alert('도착할 주소(Target URL)를 입력해주세요.'); 
                document.getElementById('baseUrl').focus();
                return; 
            }
            
            // [Simulation] 중복 체크 로직
            // 실제 개발 시: 서버에 요청을 보내서 중복이면 에러 응답을 받음
            if (code) {
                if (code === 'abc_mart' || code === 'summer') {
                    alert('❌ 이미 사용 중인 단축 코드입니다.\n다른 코드를 입력하거나 비워두세요 (자동생성).');
                    codeInput.focus();
                    codeInput.classList.add('border-red-500', 'bg-red-50'); // 에러 표시
                    setTimeout(() => codeInput.classList.remove('border-red-500', 'bg-red-50'), 2000);
                    return; // 생성 중단
                }
            } else {
                // 코드가 없으면 자동생성 (여기선 데모용 랜덤)
                code = Math.random().toString(36).substring(2, 8);
                // 자동 생성된 것을 사용자에게 보여줄지 여부는 선택사항. 여기선 보여줌.
                // codeInput.value = code; 
            }

            // [성공 시 로직] 실제로는 여기서 AJAX로 서버에 전송
            showToast('✅ 링크가 생성되었습니다: /l/' + code);
            
            // 입력값 초기화 (옵션)
            document.getElementById('shortCode').value = '';
            document.getElementById('memo').value = '';
            
            // 리스트에 추가하는 로직은 생략 (새로고침 시 반영)
        }

        // 3. 리스트 검색
        function filterList() {
            const input = document.getElementById('searchInput');
            const filter = input.value.toUpperCase();
            const table = document.getElementById('dataTable');
            const tr = table.getElementsByTagName('tr');

            for (let i = 1; i < tr.length; i++) {
                const tdCode = tr[i].getElementsByTagName('td')[0];
                const tdInfo = tr[i].getElementsByTagName('td')[1];
                if (tdCode || tdInfo) {
                    const txtValue = (tdCode.textContent + tdInfo.textContent);
                    if (txtValue.toUpperCase().indexOf(filter) > -1) {
                        tr[i].style.display = "";
                    } else {
                        tr[i].style.display = "none";
                    }
                }       
            }
        }

        // 4. 복사 & 토스트
        function copyLink(code) {
            const url = 'https://orderz.kr/l/' + code;
            const el = document.createElement('textarea');
            el.value = url;
            document.body.appendChild(el);
            el.select();
            document.execCommand('copy');
            document.body.removeChild(el);
            showToast('복사됨: ' + url);
        }

        function showToast(msg) {
            const t = document.getElementById('toast');
            t.textContent = msg;
            t.classList.remove('opacity-0');
            setTimeout(() => t.classList.add('opacity-0'), 2000);
        }
    </script>
</body>
</html>
